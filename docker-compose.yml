services:
  rust-ci:
    build:
      context: .
      dockerfile: docker/rust-ci.Dockerfile
    user: "${USER_ID:-1000}:${GROUP_ID:-1000}"
    volumes:
      - .:/app
      - cargo-registry-cache:/tmp/cargo
    environment:
      - CARGO_HOME=/tmp/cargo
      - RUSTUP_HOME=/usr/local/rustup
      - CARGO_INCREMENTAL=1
      - CI=true
    working_dir: /app
    command: ["/bin/bash"]
    stdin_open: true
    tty: true
    profiles:
      - ci

  ppsspp:
    build:
      context: .
      dockerfile: ci/Dockerfile-ppsspp
    volumes:
      - ./target/mipsel-sony-psp:/roms:ro
    environment:
      - PPSSPP_HEADLESS=${PPSSPP_HEADLESS:-1}
    profiles:
      - psp

volumes:
  cargo-registry-cache:
